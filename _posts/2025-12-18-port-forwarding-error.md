---
title: "포트포워딩 에러"
date: 2025-12-18
last_modified_at: 2025-12-18
categories:
  - TroubleShooting
tags:
  - Server
  - Ubuntu
  - Network
sidebar:
  nav: "sidebar-category"
---

## 0. 포트포워딩 에러 발생?

이번달 초에 어렵게 어렵게 포트포워딩을 완료하고, 도커 서버를 띄운 우분투 서버를 실행했다.  
해당 ip로 접속 성공하고, 그동안의 삽질이 헛된 일은 아니였구나! 하고 기뻐하던 와중  
친구들한테 자랑을 하려고 해당 ip 주소를 보내주었다.  
그런데 친구가 갑자기 "뭐야, 접속이 안되는데?" 라는 말을 했다.  
확인해보니 나는 공유기를 사용한 환경이여서 내부망으로 접속 성공한 것이였고,  
친구는 외부 ip니깐 접속이 안되었던 것이다.  
포트포워딩을 분명 완료했는데, 어째서 이런일이 벌어진 것일까?

## 1. 문제점 파악

문제는 내 와이파이 공유기 구성의 문제였다.  

 ![ 공유기 1 ](/assets/png/공유기1.png)

 이게 내 공유기 구조인데, 보면 와이파이 공유기(상위 공유기)에 인터넷 tv 셋탑박스(하위 공유기)가 연결되어있다.
 확인했을때, 하위 공유기가 NAT 설정이 되어있어, 이중 NAT로 하위 공유기가 포트포워딩을 무시하고 있기 때문이다.

## 2. 해결 시도

    1. DMZ 세팅으로 내 추론이 맞는지 확인  

        - DMZ란? -> 외부 네트워크와 내부 네트워크 사이에서 외부 네트워크 서비스를 제공하면서 내부 네트워크를 보호하는 서브넷, 즉 외부에 오픈된 서버영역을 말한다.  
        그러나 DMZ는 포트를 열어 사용했을 경우, 내부 네트워크가 노출되는 문제가 있어 심각한 보안 문제가 발생한다.  
        고로, 이는 오로지 확인으로만 사용해보았다.

        - DMZ를 오픈하고 해당 ip로 접속을 시도하자, 접속에 성공하였다!

    2. 하위 공유기를 브릿지 모드 (허브모드) 설정  

        - 브릿지 모드란? -> 네트워크 장비(모뎀, 공유기 등)가 라우터 기능을 끄고 마치 '다리(Bridge)'처럼 단순히 신호를 전달하는 모드로,  
        주로 이중 공유기 문제 해결, 네트워크 성능 최적화, 또는 가상화 환경에서 다른 네트워크와 투명하게 연결할 때 사용

        - 이 방법은 하드웨어 적인 문제로 해당 공유기가 설정을 지원하지 않는 문제로 불가능했다.

        - 서버 컴퓨터를 랜선으로 직접 상위 공유기에 연결하는 방법은 있었으나, 나는 기술적인 해결을 원했다.

    3. 도메인을 부여해보자!

        - 검색을 해본 결과, NAT Loopback 이라는 현상때문일 수도 있다는 해결책을 찾았다.  
        동일한 내부망 내에서 내부 ip를치고 들어가려고 하면 동일한 내부 ip로 착각하며 패킷을 버리는 경우가 있다고 한다.

        - duckdns라는 무료 도메인 부여 사이트에서 도메인을 부여받아, 서버 ip에 도메인을 부여했다.
        이러면 DNS 서버를 한번 거쳐서 들어오기 때문에, 외부 요청으로 판단하여 정상적으로 포트포워딩이 진행된다.

        - 이방법으로 나는 성공했다!

## 3. 후기

정말 문제점을 찾기 힘든 일이였다. 나는 분명히 세팅을 완료했는데 제대로 작동하지 않는다니...  
그러나 해결책을 찾고 나니 조금 더 네트워크 환경에 대해 이해도를 가지기도 했고,  
하드웨어 세팅도 무척 중요하다는 교훈을 얻었다.  
그래도 무사히 외부망으로 작동되는걸 확인하니 매우 뿌듯하다.